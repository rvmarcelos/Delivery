---
title: "Delivery"
author: "Marcelo Setubal"
date: "16/11/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(tidymodels)
library(skimr)
library(plyr)
library(dplyr)
library(torch)
library(keras)
library(magrittr)
library(ggplot2)
library(plotly)
library("rjson")
library(ggcorrplot)

df_raw <- read.csv('onlinedeliverydata.csv')

bgl <- sf::read_sf("C:/Users/USER/Desktop/Pos Data Science/Projetos Legais/Rappi/PincodeBoundary-master/Bangalore/boundary.geojson")

valores <- c('Agree', "Strongly Agree", "Neutral", "Disagree","Strongly disagree")

colunas_likert <- df_raw %>% select(where(~any(.x %in% valores))) %>% colnames()


df <- df_raw %>% 
  mutate(across(c(colunas_likert),~revalue(.x, c("Strongly disagree"= -3,
                               "Disagree"= -1,
                               "Agree"= 1,
                               "Strongly agree"= 3,
                               "Strongly Agree"= 3,
                               "Neutral"= 0)))) %>%
  mutate(across(c(colunas_likert), ~strtoi(.x))) %>% 
  mutate(Output = ifelse(Output == "Yes", 1, 0)) 

correlacao <- cor(df %>% select(where(is.numeric)))


```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Analise ExploratÃ³ria}
df %>% glimpse()
```

## Including Plots

You can also embed plots, for example:

```{r correlacao, echo=FALSE}
ggcorrplot(correlacao, hc.order = TRUE, type = "lower",
           outline.col = "white",
           ggtheme = ggplot2::theme_gray,
           colors = c("#6D9EC1", "white", "#E46726")) 
```
```{r Analise exploratoria, echo=FALSE}
colunas <- df %>%
  select(-latitude, -longitude, - Reviews, -Output, -Pin.code) %>%
  colnames()

faz_grafico <- function(x) {
  df %>%
    ggplot(aes(.data[[x]], fill = factor(Output))) +
    geom_bar(position = 'dodge', show.legend = FALSE)
}
graficos <- map(colunas, faz_grafico)

graficos


```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
